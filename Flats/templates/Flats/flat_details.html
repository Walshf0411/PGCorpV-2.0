{% extends 'Accounts/base.html' %}
{% block title %}{{object.slug}}{% endblock %}

{% block cssfiles %}
	{% load static %}
	<link rel="stylesheet" href="{% static 'Flats/flat_details.css' %}">
{% endblock %}

{% block content %}
	<!--- login modal -->
	<div class="modal fade" id="loginModal">
		<div class="modal-dialog">
			<div class="modal-content">
		
			<!-- Modal Header -->
			<div class="modal-header">
				<h4 class="modal-title">Login to continue</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
		
			<!-- Modal body -->
			<div class="modal-body">
				<ul class="nav nav-tabs">
					<li class="nav-item">
						<a class="nav-link active" data-toggle="tab" href="#login">Login</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-toggle="tab" href="#signup">Signup</a>
					</li>
				</ul>
					
					<!-- Tab panes -->
					<div class="tab-content">
					<div class="tab-pane container active" id="login">
						{% if login_form %}
							<form action="{% url 'login' %}" method="POST">
								{% load crispy_forms_tags %}
								{% csrf_token %}
								{{ login_form.username|as_crispy_field }}
								{{ login_form.password|as_crispy_field }}
								<input type="hidden" name="modal">
								<button class="btn btn-lg btn-info" type="submit">Login</button>
							</form>
						{% endif %}
					</div>
					<div class="tab-pane container fade" id="signup">
						{% if signup_form %}
							<form action="{% url 'signup' %}" method="POST">
								{% csrf_token %}
								{% load crispy_forms_tags %}
								{% crispy signup_form %}
								<input type="hidden" name="modal">
								<button class="btn btn-lg btn-info" type="submit">Signup</button>
							</form>
						{% endif %}
					</div>
					</div>
			</div>
		
			<!-- Modal footer -->
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
			</div>
		
			</div>
		</div>
	</div>

	<div class="container" id="main-container">
		<div class="row">
			<div class="col-sm-6 image-gallery">
				<img src="{% static 'General/parallax-background.jpg'%}" alt="image gallery" class="image-responsive">
			</div>
			<div class="col-sm-6">
				<h3 class="display-4">{{object.title}}</h3>
				<p>{{object.address}}</p>
				
				<div class="row" id="main-item-box">
					<div class="col-sm-4 right-border main-items" align="center">
						{{ object.total_space }}<br>
						<strong>Total Space</strong>
					</div>
					<div class="col-sm-4 right-border main-items" align="center">
						&#8377;&nbsp;{{ object.total_rent }}<br>
						<strong title="This is the total rent of the flat. If the number of guests is more than 1, this price will be divided by the number of guests">
							Total Rent
						</strong>
					</div>
					<div class="col-sm-4 main-items" align="center">
						{{ object.possession }}<br>
						<strong>Possession</strong>
					</div>
				</div>

				<div class="container" align=center>
					<div class="row">
						<div class="col-sm-6">
							<div class="more-details">
								{{ object.total_rooms }}<br>
								<strong>Number of rooms</strong>
							</div>
							<div class="more-details">
								{{ object.property_type }}<br>
								<strong>Property Type</strong>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="more-details">
								{{ object.floor }}<br>
								<strong>Floor</strong>
							</div>
							<div class="more-details">
								{{object.parking_options}}<br>
								<strong>Parking</strong>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row" align=center id="about-flat">
			<div class="col-sm-6 description-div">
				<strong class="about-head">About the flat</strong>
				<div class="line"></div>
				<p>{{object.description}}</p>
			</div>
			<div class="col-sm-6 description-div">
				<div class="row" align=center>
					<div class="col-sm-4">
						{{ object.number_of_guests }}<br>
						<strong>Number of occupants required.</strong>
					</div>
					<div class="col-sm-4">
						0<br>
						<strong>Number of people intrested in this property.</strong>
					</div>
					<div class="col-sm-4">
						0<br>
						<strong>Number of occupants in this flat.</strong>
					</div>
				</div>
			</div>
		</div>

		<div class="container" align=center id="user-actions-div">
			{% if user.is_authenticated %}
				<button class="btn btn-lg btn-info">
					Apply for reservation
				</button>
			{% else %}
				<button class="btn btn-lg btn-info" data-toggle="modal" data-target="#loginModal">
					Apply for reservation
				</button>
			{% endif %}

			{% if object.liked %}
				<button class="btn btn-lg btn-danger">
					<span class="glyphicon glyphicon-heart" id="like-button"></span>
					&nbsp;<span id="like-button-text">{{ object.favouriteflats_set.count }}</span>
				</button>
			{% else %}
				{% if user.is_authenticated %}
					<button class="btn btn-lg btn-danger">
						<span class="glyphicon glyphicon-heart-empty" id="like-button"></span>
						&nbsp;<span id="like-button-text">{{ object.favouriteflats_set.count }}</span>
					</button>
				{% else %}
					<!-- Set onclick to display login modal-->
					<button class="btn btn-lg btn-danger" data-toggle="modal" data-target="#loginModal">
						<span class="glyphicon glyphicon-heart-empty" id="like-button"></span>
						&nbsp;<span id="like-button-text">{{ object.favouriteflats_set.count }}</span>
					</button>&nbsp;
				{% endif %}
			{% endif %}
		</div>
	</div>
{% endblock %}

{% block javascript %}
<script>
	$(document).ready(function() {
		$("#like-button").click(function() {
			$.ajax({
				url: '{% url "like" %}',
				data: {
					'user': "{{ user.username }}",
					'flat': "{{ object.hash }}", 
				},
				dataType: 'json',
				success: function (data) {
					if (data.liked) {
						$("#like-button").removeClass("glyphicon-heart-empty");
						$("#like-button").addClass("glyphicon-heart");
						$("#like-button-text").text(data.count);
					}else{
						$("#like-button").addClass("glyphicon-heart-empty");
						$("#like-button").removeClass("glyphicon-heart");
						$("#like-button-text").text(data.count);
					}
				}
			})
		});
	})
</script>
{% endblock %}